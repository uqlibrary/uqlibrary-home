<!doctype html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=no">
  <title>uqlibrary-home</title>

  <script src="../../webcomponentsjs/webcomponents.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <link rel="import" href="../uqlibrary-home.html">
</head>
<body>

  <uqlibrary-home></uqlibrary-home>

  <script>
    window.addEventListener('polymer-ready', function() {
      var parent = document.querySelector('uqlibrary-home');
      var mainContent = parent.shadowRoot.querySelector('core-drawer-panel').querySelector('.main');
      var homeElements = mainContent.querySelector('#content').querySelector('#pages').querySelector('#homePage');

      describe('uqlibrary-home', function () {
        before(function () {

        });

          test('my library home should have proper core drawer panel structure and heading for accessibility', function(done) {
              setTimeout(function() {
                  var pageTitle = mainContent.querySelector('core-toolbar').querySelector('h1').innerText;
                  expect(pageTitle).to.be.equal("My Library");
                  done();
              }, 10);
          });

          test('my library home should have the search box', function(done) {
              setTimeout(function() {
                  var searchBox = homeElements.querySelectorAll('div')[0].querySelector('div').querySelector('uqlibrary-search').shadowRoot.querySelector('paper-shadow');
                  expect(searchBox.id).to.be.equal("searchWrapper");
                  done();
              }, 10);
          });

          test('my library home should have 6 home screen icons', function(done) {
              setTimeout(function() {
                var homeApps = homeElements.querySelector('#apps');
                expect(homeApps).not.to.be.null;

                var homeAppsLinks = homeElements.querySelectorAll('#apps a')
                expect(homeAppsLinks.length).to.be.at.least(1);

                done();
              }, 1000);
          });

          test('my library home screen icons should be accessible', function(done) {
              setTimeout(function() {
                var homeApps = homeElements.querySelectorAll('#apps a');
                expect(homeApps.length).to.be.at.least(1);

                  var numApps = 0;
                  while (numApps < homeApps.length) {
                      expect(homeApps[numApps].querySelector('paper-button').querySelector('core-icon')).to.have.property('alt');
                      expect(homeApps[numApps].querySelector('paper-button').querySelector('core-icon').alt).to.not.equal("");
                      numApps++;
                  }
                  done();
              }, 10);
          });

        test('undergraduate students should not have access to masquerade function', function(done) {

          expect(parent.user.type).to.equal(1);

          setTimeout(function() {
            var masqueradeApp = homeElements.querySelector('#uqlibrary-masquerade');
            expect(masqueradeApp).to.be.null;

            done();
          }, 1000);
        });

        test('changing user type should change availability of apps', function(done) {

          parent.user.type = 18;
          parent.userChanged();

          expect(parent.user.type).to.equal(18);

          setTimeout(function() {
            var masqueradeApp = homeElements.querySelector('#uqlibrary-masquerade');
            expect(masqueradeApp).not.to.be.null;
            done();
          }, 1000);
        });

      });

    });
  </script>

</body>
</html>
