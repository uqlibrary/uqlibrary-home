<link rel="import" href="../uqlibrary-elements/0.5.4/lib/vulcanized.html">
<link rel="import" href="uqlibrary-app.html">

<polymer-element name="uqlibrary-home" extends="uqlibrary-app">

  <template>
    <link rel="stylesheet" href="../uqlibrary-elements/resources/theme/element.css">

    <uqlibrary-api-account id="account"></uqlibrary-api-account>

    <core-drawer-panel id="drawerPanel" class="drawer" drawerWidth="256px" responsiveWidth="768px">

      <core-header-panel drawer>
        <uqlibrary-menu account="{{user}}"></uqlibrary-menu>
      </core-header-panel>

      <core-header-panel main class="main">
        <core-toolbar>
          <core-a11y-keys id="a11yToolBarLeftButton" target="{{$.toolBarLeftButton}}" keys="{{keyboardNavigationKeys}}"
                          on-keys-pressed="{{ a11yKeyPressed }}"></core-a11y-keys>
          <paper-icon-button
            core-drawer-toggle
            id="toolBarLeftButton"
            hidden?="{{!pageToolbar.leftButton.icon}}"
            icon="{{pageToolbar.leftButton.icon ? pageToolbar.leftButton.icon : ''}}"></paper-icon-button>

          <h1 flex id="toolbar-page-title" class="body1 inverse">{{pageToolbar.title}}</h1>

          <core-a11y-keys id="a11ytoolBarRightButton" target="{{$.toolBarRightButton}}" keys="{{keyboardNavigationKeys}}"
                          on-keys-pressed="{{ a11yKeyPressed }}"></core-a11y-keys>
          <paper-icon-button
            id="toolBarRightButton"
            on-tap="{{doTransition}}"
            hidden?="{{!pageToolbar.rightButton.icon}}"
            icon="{{pageToolbar.rightButton.icon ? pageToolbar.rightButton.icon : ''}}"></paper-icon-button>
        </core-toolbar>

        <div id="content">
          <core-animated-pages
            id="pages"
            transitions="{{transition}}"
            on-core-animated-pages-transition-prepare="{{transitionPrepareHandler}}"
            on-core-animated-pages-transition-end="{{transitionEndHandler}}">

            <section id="homePage">
              <div flex horizontal center-justified layout>
                <div flex><uqlibrary-search></uqlibrary-search></div>
                </div>

              <div flex class="apps" id="apps" horizontal layout wrap>

                  <a href="../chat" class="app">
                      <paper-button>
                          <core-icon alt="Ask the Library for help" icon="question-answer" class="huge home-icon"></core-icon>
                      </paper-button>
                      <p class="iconLabel" for>Ask the Library</p>
                  </a>
                  <a href="../booking" class="app">
                      <paper-button>
                          <core-icon alt="Manage or view My Library Booking" icon="event" class="huge home-icon"></core-icon>
                      </paper-button>
                      <p class="iconLabel" for>Booking</p>
                  </a>
                  <a href="../borrowing" class="app">
                      <paper-button>
                          <core-icon alt="Manage or view My Library Borrowing" icon="maps:local-library" class="huge home-icon"></core-icon>
                      </paper-button>
                      <p class="iconLabel" for>Borrowing</p>
                  </a>

                  <a href="../computers" class="app">
                      <paper-button><core-icon alt="View My Library Hours" icon="hardware:desktop-mac" class="huge home-icon"></core-icon></paper-button>
                      <p class="iconLabel" for>Computers</p>
                  </a>

                <template if="{{user.classes.length}}">
                    <a href="../courses" class="app">
                        <paper-button><core-icon alt="View My Library Course Learning Resources" icon="social:school" class="huge home-icon"></core-icon></paper-button>
                        <p class="iconLabel" for>Courses</p>
                    </a>
                </template>

                  <a href="../hours" class="app">
                      <paper-button><core-icon alt="View My Library Opening Hours" icon="schedule" class="huge home-icon"></core-icon></paper-button>
                      <p class="iconLabel" for>Hours</p>
                  </a>

                  <a href="../feedback" class="app">
                      <paper-button><core-icon alt="Leave Feedback for My Library" icon="communication:comment" class="huge home-icon"></core-icon></paper-button>
                      <p class="iconLabel" for>Feedback</p>
                  </a>

                <template if="{{user.canMasquerade}}">

                    <a href="../masquerade" class="app">
                        <paper-button><core-icon alt="Masquerade as another Library user" icon="perm-identity" class="huge home-icon"></core-icon></paper-button>
                        <p class="iconLabel" for>Masquerade</p>
                    </a>

                </template>
              </div>

            </section>

          </core-animated-pages>

        </div>

      </core-header-panel>

    </core-drawer-panel>

    <paper-toast id="primaryToast" role="alert" text="{{toastText}}"></paper-toast>

  </template>

  <script>
    (function() {
      Polymer('uqlibrary-home', {

        // Accessibility issues fixes

        keyboardNavigationKeys: 'space enter',

        a11yKeyPressed: function(source, event) {
          if (source.path && source.path.length > 0 && source.path[0].target) {
            source.path[0].target.fire("tap");
          }
        },

        appName: 'HOME',

        transition: 'slide-from-right',
        currentPage: 'homePage',
        transitioning: false,

        created: function () {

          this.pageTransitions = {
          };
        },

        ready: function() {
          var that = this;
          this.$.account.addEventListener('uqlibrary-api-account-loaded', function(e) {
            if (e.detail.hasSession) {
              that.user = e.detail;
            } else {
              that.$.account.login(document.location.href);
            }
          });
          this.$.account.get();
          this.showHomePage();
        },

        showHomePage: function() {
          this.pageTransitions.toolBarLeftButton = {
            action: 'togglePanel'
          };

          this.pageToolbar = {
            leftButton: {icon:'menu'},
            title: 'My Library'
          };
        },

        transitionPrepareHandler: function() {
          this.transitioning = true;
          this.fire('core-signal', {name: "transitioning-change", data: {transitioning: this.transitioning}});
        },

        transitionEndHandler: function() {
          this.transitioning = false;
          this.fire('core-signal', {name: "transitioning-change", data: {transitioning: this.transitioning}});
        }

      });
    })();
  </script>

</polymer-element>
