<link rel="import" href="../uqlibrary-elements/0.5.4/lib/vulcanized.html">
<link rel="import" href="uqlibrary-app.html">
<link rel="import" href="uqlibrary-loans-page.html">
<link rel="import" href="uqlibrary-hours-page.html">
<link rel="import" href="uqlibrary-availability-page.html">
<link rel="import" href="uqlibrary-masquerade-page.html">
<link rel="import" href="uqlibrary-courses-page.html">

<polymer-element name="uqlibrary-home" extends="uqlibrary-app">

  <template>
    <link rel="stylesheet" href="uqlibrary-home.css">

    <uqlibrary-api-account id="account"></uqlibrary-api-account>

    <core-drawer-panel id="drawerPanel" drawerWidth="256px" responsiveWidth="768px">

      <core-header-panel drawer id="drawer">
        <uqlibrary-menu account="{{user}}"></uqlibrary-menu>
      </core-header-panel>

      <core-header-panel main id="main">
        <core-toolbar>
          <paper-icon-button
            core-drawer-toggle
            id="toolBarLeftButton"
            hidden?="{{!pageToolbar.leftButton.icon}}"
            icon="{{pageToolbar.leftButton.icon ? pageToolbar.leftButton.icon : ''}}"></paper-icon-button>
          <span flex id="toolbar-page-title">{{pageToolbar.title}}</span>
          <paper-icon-button
            id="toolBarRightButton"
            on-tap="{{doTransition}}"
            hidden?="{{!pageToolbar.rightButton.icon}}"
            icon="{{pageToolbar.rightButton.icon ? pageToolbar.rightButton.icon : ''}}"></paper-icon-button>
        </core-toolbar>

        <div id="content">
          <core-animated-pages
            id="pages"
            transitions="{{transition}}"
            on-core-animated-pages-transition-prepare="{{transitionPrepareHandler}}"
            on-core-animated-pages-transition-end="{{transitionEndHandler}}">

            <section id="homePage">
              <div flex horizontal center-justified layout>
                <div flex><uqlibrary-search></uqlibrary-search></div>
                </div>

              <div flex class="apps" horizontal layout wrap>

                <core-label>
                  <div flex class="app" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/booking">
                    <paper-icon-button icon="event" title="Booking" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/booking" class="huge home-icon"></paper-icon-button>
                    <p class="iconLabel" for>Booking</p>
                  </div>
                </core-label>

                <core-label>
                  <div flex class="app" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/borrowing">
                    <paper-icon-button icon="maps:local-library" title="Borrowing" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/borrowing" class="huge home-icon"></paper-icon-button>
                    <p class="iconLabel" for>Borrowing</p>
                  </div>
                </core-label>

                <core-label>
                  <div flex class="app" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/computers/">
                    <paper-icon-button icon="hardware:desktop-mac" title="Computers" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/computers/" class="huge home-icon"></paper-icon-button>
                    <p class="iconLabel" for>Computers</p>
                  </div>
                </core-label>

                <template if="{{user.classes.length}}">
                <core-label>
                  <div flex class="app" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/courses">
                    <paper-icon-button icon="social:school" title="Courses" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/courses" class="huge home-icon"></paper-icon-button>
                    <p class="iconLabel" for>Courses</p>
                  </div>
                </core-label>
                </template>

                <core-label>
                  <div flex class="app" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/hours">
                    <paper-icon-button icon="schedule" title="Courses" on-tap="{{go}}" link="https://app.library.uq.edu.au/v1/courses" class="huge home-icon"></paper-icon-button>
                    <p class="iconLabel" for>Hours</p>
                  </div>
                </core-label>

                <template if="{{user.canMasquerade}}">

                  <core-label>
                    <div flex class="app" on-tap="{{doTransition}}" id="showMasqueradePage">
                      <paper-icon-button icon="perm-identity" title="Masquerade" on-tap="{{doTransition}}" id="showMasqueradePage" class="huge home-icon"></paper-icon-button>
                      <p class="iconLabel" for>Masquerade</p>
                    </div>
                  </core-label>

                </template>
              </div>

            </section>

            <section id="loansPage">
              <uqlibrary-loans-page id="loansPageEl"></uqlibrary-loans-page>
            </section>

            <section id="hoursPage">
              <uqlibrary-hours-page id="hoursPageEl"></uqlibrary-hours-page>
            </section>

            <section id="availabilityPage">
              <uqlibrary-availability-page id="availabilityPageEl"></uqlibrary-availability-page>
            </section>

            <section id="masqueradePage">
              <uqlibrary-masquerade-page id="masqueradePageEl"></uqlibrary-masquerade-page>
            </section>

            <section id="coursesPage">
              <uqlibrary-courses-page id="coursesPageEl" user="{{user}}"></uqlibrary-courses-page>
            </section>
          </core-animated-pages>

        </div>

      </core-header-panel>

    </core-drawer-panel>

    <paper-toast id="primaryToast" role="alert" text="{{toastText}}"></paper-toast>

  </template>

  <script>
    (function() {
      Polymer('uqlibrary-home', {

        appName: 'HOME',

        transition: 'slide-from-right',
        currentPage: 'homePage',
        transitioning: false,

        created: function () {
          this.notifications = [
            {
              text: 'You have new booking',
              image: 'images/notification.png',
              link: 'https://app.library.uq.edu.au/v1/booking',
              isNew: true
            },
            {
              text: 'You 2 loans overdue',
              link: 'https://app.library.uq.edu.au/v1/booking',
              isNew: true
            },
            {
              text: 'New e-journal have been released',
              link: 'https://app.library.uq.edu.au/v1/booking',
              isNew: false
            },
            {
              text: 'You have new booking',
              image: 'images/notification.png',
              link: '',
              isNew: false
            },
            {
              text: 'You 2 loans overdue',
              link: 'https://app.library.uq.edu.au/v1/booking',
              isNew: false
            }
          ];
          this.pageTransitions = {
            showLoansPage: {
              transition: 'slide-from-right',
              destination: 'loansPage',
              action: 'showLoansPage'
            },
            showAvailabilityPage: {
              transition: 'slide-from-right',
              destination: 'availabilityPage',
              action: 'showAvailabilityPage'
            },
            showHoursPage: {
              transition: 'slide-from-right',
              destination: 'hoursPage',
              action: 'showHoursPage'
            },
            showMasqueradePage: {
              transition: 'slide-from-right',
              destination: 'masqueradePage',
              action: 'showMasqueradePage'
            },
            showCoursesPage: {
              transition: 'slide-from-right',
              destination: 'coursesPage',
              action: 'showCoursesPage'
            }
          };
        },

        ready: function() {
          var that = this;
          this.$.account.addEventListener('uqlibrary-api-account-loaded', function(e) {
            if (e.detail.hasSession) {
              that.user = e.detail;
            } else {
              that.$.account.login('https://app.library.uq.edu.au/v1/home');
            }
          });
          this.$.account.get();
          this.showHomePage();
        },

        go: function (e, _, el) {
          document.location.href = el.attributes.link.value;
        },

        showHomePage: function() {
          this.pageTransitions.toolBarLeftButton = {
            action: 'togglePanel'
          };

          this.pageToolbar = {
            leftButton: {icon:'menu'},
            title: 'My Library'
          };
        },

        showLoansPage: function() {
          this.pageTransitions.toolBarLeftButton = {
            transition: 'slide-from-right',
            destination: 'homePage',
            action: 'showHomePage'
          };

          this.pageToolbar = {
            leftButton: {icon:'arrow-back'},
            title: 'Loans'
          };
          this.$.loansPageEl.show();
        },

        showAvailabilityPage: function() {
          this.pageTransitions.toolBarLeftButton = {
            transition: 'slide-from-right',
            destination: 'homePage',
            action: 'showHomePage'
          };

          this.pageToolbar = {
            leftButton: {icon:'arrow-back'},
            title: 'Computers'
          };
          this.$.availabilityPageEl.show();
        },

        showHoursPage: function() {
          this.pageTransitions.toolBarLeftButton = {
            transition: 'slide-from-right',
            destination: 'homePage',
            action: 'showHomePage'
          };

          this.pageToolbar = {
            leftButton: {icon:'arrow-back'},
            title: 'Hours'
          };
          this.$.hoursPageEl.show();
        },

        showMasqueradePage: function() {
          this.pageTransitions.toolBarLeftButton = {
            transition: 'slide-from-right',
            destination: 'homePage',
            action: 'showHomePage'
          };

          this.pageToolbar = {
            leftButton: {icon:'arrow-back'},
            title: 'Masquerade'
          };
        },

        showCoursesPage: function() {
          this.pageTransitions.toolBarLeftButton = {
            transition: 'slide-from-right',
            destination: 'homePage',
            action: 'showHomePage'
          };

          this.pageToolbar = {
            leftButton: {icon:'arrow-back'},
            title: 'Courses'
          };

          this.$.coursesPageEl.show();

        },

        transitionPrepareHandler: function() {
          this.transitioning = true;
          this.fire('core-signal', {name: "transitioning-change", data: {transitioning: this.transitioning}});
        },
        transitionEndHandler: function() {
          this.transitioning = false;
          this.fire('core-signal', {name: "transitioning-change", data: {transitioning: this.transitioning}});
        }

      });
    })();
  </script>

</polymer-element>
